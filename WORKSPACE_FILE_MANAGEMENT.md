 # 工作空间文件管理说明

## 概述

ZZZero AI Agent 现在支持统一的工作空间文件管理，解决了文件创建和存储的问题。所有Agent创建的文件都会保存在指定的工作空间目录中，并且可以通过前端界面进行管理。

## 工作空间目录结构

```
./workspace/
├── input/          # 输入文件夹 - 用户上传的文件
├── output/         # 输出文件夹 - Agent创建的文件
├── vectordb/       # 向量数据库存储目录
└── temp/           # 临时文件目录
```

## 前端文件管理功能

### 1. 文件上传
- 在Web界面的左侧配置面板中，找到"📁 文件管理"区域
- 切换到"上传文件"标签页
- 点击"上传文件到输入目录"选择本地文件
- 点击"上传文件"按钮完成上传

### 2. 文件浏览
- 切换到"文件浏览"标签页
- 可以查看输入文件夹和输出文件夹中的所有文件
- 显示文件名、大小、修改时间等信息
- 点击"刷新文件列表"按钮更新文件列表

## Agent工具能力

### 1. 文件管理工具
Agent现在可以使用以下工具进行文件操作：

#### `list_input_files`
- 列出输入目录中的所有文件
- 返回文件名、路径、大小、修改时间等信息

#### `read_input_file`
- 读取输入目录中的文件内容
- 支持多种编码格式（UTF-8、GBK、GB2312等）
- 自动检测文件编码

#### `write_output_file`
- 在输出目录中创建新文件
- 支持任意文本内容
- 可指定文件编码

#### `copy_input_to_output`
- 将输入文件复制到输出目录
- 可选择重命名文件

#### `delete_output_file`
- 删除输出目录中的文件

### 2. CSV数据库操作
- CSV文件默认保存在 `./workspace/output/` 目录
- 使用 `create_table` 等工具创建的CSV文件会自动出现在输出文件夹

### 3. ChromaDB向量数据库
- 向量数据库文件保存在 `./workspace/vectordb/` 目录
- 创建的集合会持久化存储，不会丢失

## 使用示例

### 1. 处理上传的CSV文件
```
用户：我上传了一个sales_data.csv文件，请帮我分析销售数据并生成报告

Agent会：
1. 使用 list_input_files 查看上传的文件
2. 使用 read_input_file 读取CSV内容
3. 分析数据并创建报告
4. 使用 write_output_file 保存分析报告到输出目录
```

### 2. 创建向量数据集合
```
用户：请创建一个产品知识库的向量数据集合

Agent会：
1. 使用 create_collection 创建ChromaDB集合
2. 数据自动保存在 ./workspace/vectordb/ 目录
3. 集合持久存在，下次启动仍然可用
```

### 3. 生成文档并导出
```
用户：基于我的数据生成一份详细的分析报告

Agent会：
1. 读取输入数据
2. 进行分析处理
3. 使用 write_output_file 生成报告文件
4. 文件出现在前端的输出文件夹中，可以下载
```

## 配置说明

工作空间路径在以下文件中配置：

### Web应用配置 (`src/web/app.py`)
```python
self.workspace_config = {
    'base_dir': './workspace',
    'input_dir': './workspace/input',
    'output_dir': './workspace/output',
    'vectordb_dir': './workspace/vectordb',
    'temp_dir': './workspace/temp'
}
```

### MCP服务器配置
- CSV服务器：`./workspace/output`
- ChromaDB服务器：`./workspace/vectordb`
- 文件管理服务器：`./workspace`

## 技术实现

### 1. 统一路径管理
所有MCP服务器都使用统一的工作空间路径，确保文件保存位置一致。

### 2. 前端文件管理
- 使用Gradio的File组件实现文件上传
- HTML格式化显示文件列表
- 实时刷新文件状态

### 3. MCP工具集成
- 新增文件管理MCP服务器
- 提供完整的文件CRUD操作
- 支持多种文件编码格式

## 注意事项

1. **文件权限**：确保应用对工作空间目录有读写权限
2. **文件大小**：大文件上传可能需要更长时间
3. **编码格式**：中文文件建议使用UTF-8编码
4. **数据持久化**：工作空间中的文件会持久保存，重启应用不会丢失

## 故障排除

### 文件上传失败
- 检查文件路径和权限
- 确认工作空间目录是否正确创建

### Agent无法读取文件
- 确认文件管理服务器是否启动
- 检查MCP服务器状态

### 向量数据库无法保存
- 确认ChromaDB依赖是否正确安装
- 检查vectordb目录权限

通过这套文件管理系统，您可以方便地与AI Agent进行文件交互，所有创建的文件都会统一管理，便于查看和下载。